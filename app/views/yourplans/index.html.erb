<p id="notice"><%= notice %></p>

<h1>Yourplans</h1>
<!-- Latest compiled and minified Bootstrap CSS -->
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/css/bootstrap.min.css">
<% if student_signed_in? %>
    <br>
    <div class="panel-group" id="accordion">
      <% @yourplans.each do |yourplan| %>
          <% items = Schedule.select('id,semester,day,time').group('semester').where(:id => yourplan.schedule_id) %>
          <% items.each do |schedule| %>
              <% courses = Course.select('id,code,course_name,syllabus_id,description,prerequisites,core').where(:id => yourplan.courses) %>
              <% courses.each do |course| %>
                  <div class="panel panel-default">
                    <div class="panel-heading">
                      <h4 class="panel-title">
                        <a class="accordion-toggle" data-toggle="collapse" data-parent="#accordion" href="#collapseOne<%= course.syllabus_id %>">
                          CSC <%= course.code %> - <%= course.course_name %>
                        </a>
                        <% if course.core %>
                            <%= image_tag("red-flag-md.png", size: "10x10", :alt => "Core course", title: "Core course") %>
                        <% end %>
                        <i><span style="float: right;padding-right: 18px;"> <%= schedule.semester %>: <%= schedule.day %>, <%= schedule.time %>
                          </span></i>
                      </h4>
                    </div>
                    <div id="collapseOne<%= course.syllabus_id %>" class="panel-collapse collapse">
                      <div class="panel-body">
                        <p style="text-align:justify"><%= course.description %></p>
                        <i>Prerequisites: <%= course.prerequisites %> <br></i>
                        <i><br>
                          <%= schedule.semester %>: <%= schedule.day %>, <%= schedule.time %>
                          <%= button_to 'Remove from MyPlan', yourplan, method: :delete, data: { confirm: 'Are you sure?' } %>

                        </i><br>
                        <%= link_to('Course syllabus', "syllabus/#{course.code}.pdf", download: "#{course.course_name}") %>
                        <br>
                        <%= link_to('PalTalk', "forum/csc-#{course.code}", target: :_blank) %>
                      </div>
                    </div>
                  </div>
              <% end %>
          <% end %>
      <% end %>
    </div>
<% end %>
<!-- Latest compiled and minified JavaScript -->
<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/js/bootstrap.min.js"></script>
<table>
  <thead>
    <tr>
      <th>Student</th>
      <th>Courses</th>
      <th>Schedule</th>
      <th colspan="3"></th>
    </tr>
  </thead>

  <tbody>
    <% @yourplans.each do |yourplan| %>
      <% schedule = Schedule.select('id,semester,day,time,course_id').group('semester').where(:course_id => yourplan.courses, :semester => 'Fall' ) %>
      <tr>
        <td><%= yourplan.student %></td>
        <td><%= yourplan.courses %></td>
        <td><%= yourplan.schedule_id %></td>
        <td><%= link_to 'Show', yourplan %></td>
        <td><%= link_to 'Edit', edit_yourplan_path(yourplan) %></td>
        <td><%= link_to 'Destroy', yourplan, method: :delete, data: { confirm: 'Are you sure?' } %></td>
      </tr>
    <% end %>
  </tbody>
</table>

<br>

<%= link_to 'New Yourplan', new_yourplan_path %>
